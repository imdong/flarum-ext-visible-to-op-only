{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@imdong/flarum-ext-visible-to-op-only/webpack/bootstrap","webpack://@imdong/flarum-ext-visible-to-op-only/webpack/runtime/compat get default export","webpack://@imdong/flarum-ext-visible-to-op-only/webpack/runtime/define property getters","webpack://@imdong/flarum-ext-visible-to-op-only/webpack/runtime/hasOwnProperty shorthand","webpack://@imdong/flarum-ext-visible-to-op-only/webpack/runtime/make namespace object","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['common/app']\"","webpack://@imdong/flarum-ext-visible-to-op-only/./src/common/index.ts","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['forum/app']\"","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['common/extend']\"","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['forum/components/ReplyComposer']\"","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['common/models/Post']\"","webpack://@imdong/flarum-ext-visible-to-op-only/./src/forum/renderOnlyOpSee.js","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['common/components/TextEditor']\"","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['common/components/TextEditorButton']\"","webpack://@imdong/flarum-ext-visible-to-op-only/external root \"flarum.core.compat['common/utils/styleSelectedText']\"","webpack://@imdong/flarum-ext-visible-to-op-only/./src/forum/addOnlyOpSeeBtnToTextEditeor.js","webpack://@imdong/flarum-ext-visible-to-op-only/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\ntype TranslatorParameters = Record<string, unknown>;\n\n/**\n * 统一前缀\n */\nexport const extPrefix = 'imdong-visible-to-op-only'\n\n/**\n * 获取一个 key\n * @param key\n */\nexport function key(key: string): string {\n  return `${extPrefix}.${key.replace(/^\\.*/, '')}`\n}\n\n/**\n * 获取特定 key 的翻译\n * @param id\n * @param parameters\n */\nexport function trans(id: string, parameters: TranslatorParameters = {}) {\n  return app.translator.trans(key(id), parameters);\n}\n\nexport default {\n  extPrefix,\n  key,\n  trans\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ReplyComposer'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Post'];","import {override} from 'flarum/common/extend';\nimport Post from 'flarum/common/models/Post';\nimport {trans} from \"../common\";\n\nfunction onlyOpSee(innerHTML, canViewHidePosts, isPreview) {\n  return innerHTML.replace(/<onlyopsee>(.*?)<\\/onlyopsee>/gis, function (full, text) {\n    return render(canViewHidePosts, text, isPreview);\n  })\n}\n\nfunction render(canViewHidePosts, text, isPreview) {\n  let title = trans(canViewHidePosts ? `forum.only_op_see` : 'forum.hidden_content_only_op_see')\n  if (!app.session.user.attribute('canVisibleToOpPermissionsViewButton') && isPreview) {\n    return `${text || \"\"}`\n  }\n  return `<div class=\"onlyopsee\" data-title-content=\"${title}\" >${text || \"\"}</div>`\n}\n\nexport default function renderOnlyOpSee() {\n  override(Post.prototype, 'contentHtml', function (original, content) {\n\n    // 如果不能看见正文 就直接给拒绝文案\n    if (!this.attribute('canViewPosts')) {\n      return render(false, false)\n    }\n\n    this.attribute('canVisibleToOpPermissionsViewButton')\n\n    // 否则替换正文\n    return onlyOpSee(original(), this.attribute('canViewHidePosts'), false)\n  });\n\n  // 预览时\n  override(s9e.TextFormatter, 'preview', (original, text, element) => {\n    original(text, element);\n\n    element.innerHTML = onlyOpSee(element.innerHTML, true, true)\n  });\n\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditor'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/TextEditorButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/styleSelectedText'];","import {extend} from \"flarum/common/extend\";\nimport TextEditor from \"flarum/common/components/TextEditor\";\nimport TextEditorButton from \"flarum/common/components/TextEditorButton\";\nimport styleSelectedText from 'flarum/common/utils/styleSelectedText';\nimport {trans} from \"../common\";\n\nconst style = {prefix: '[OP]', suffix: '[/OP]', trimFirst: true};\n\nexport default function addOnlyOpSeeBtnToTextEditeor() {\n  extend(TextEditor.prototype, 'toolbarItems', function (items) {\n    if (!app.session.user.attribute('canVisibleToOpPermissionsViewButton')) {\n      return;\n    }\n    if (app.composer.body.attrs.discussion || app.composer.body.attrs.post) {\n      items.add(\n        \"only-op-see\",\n        <TextEditorButton\n          onclick={() => styleSelectedText(this.attrs.composer.editor.el, style)}\n          icon=\"fas fa-user-shield\"\n        >\n          {trans(\"forum.button_tooltip_only_op_see\")}\n        </TextEditorButton>\n      );\n    }\n  })\n}\n","import app from 'flarum/forum/app';\nimport {override} from \"flarum/common/extend\";\nimport ReplyComposer from \"flarum/forum/components/ReplyComposer\";\nimport {extPrefix, trans} from \"../common\";\nimport renderOnlyOpSee from \"./renderOnlyOpSee\";\nimport addOnlyOpSeeBtnToTextEditeor from \"./addOnlyOpSeeBtnToTextEditeor\";\n\napp.initializers.add(extPrefix, () => {\n\n  // 添加按钮到工具栏\n  addOnlyOpSeeBtnToTextEditeor()\n\n  // 各种前端渲染\n  renderOnlyOpSee();\n\n  // 包含空结构就不要提交了\n  override(ReplyComposer.prototype, 'onsubmit', function (original, content) {\n    if (/\\[OP\\]\\s*\\[\\/OP\\]/.test(content)) {\n      app.alerts.show({\n        type: \"error\",\n      }, trans('forum.editor_empty_tips'));\n      return false\n    }\n\n    original()\n  })\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","extPrefix","replace","trans","id","parameters","app","onlyOpSee","innerHTML","canViewHidePosts","isPreview","full","text","render","title","session","user","attribute","style","prefix","suffix","trimFirst","add","extend","TextEditor","items","_this","composer","body","attrs","discussion","post","m","TextEditorButton","onclick","styleSelectedText","editor","el","icon","override","Post","original","content","this","s9e","TextFormatter","element","ReplyComposer","test","show","type"],"sourceRoot":""}